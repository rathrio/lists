#! /bin/sh
#
# Migrate and restart services in production.

# Shutdown first to free up memory
bundle exec sidekiqctl stop tmp/pids/sidekiq.pid
kill -9 $(cat /tmp/lists.pid)

bundle install
yarn install

bundle exec rake assets:precompile
bundle exec rake db:migrate

bundle exec sidekiq -C config/sidekiq.yml
bundle exec puma -C config/puma_production.rb
